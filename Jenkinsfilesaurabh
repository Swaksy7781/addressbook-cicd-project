pipeline {
    agent any
    tools {
        // Ensure that the tool name 'Maven' matches the name configured in Jenkins
        maven 'Maven'
    }
    triggers {
        // This trigger listens for push events from GitHub
        githubPush()
    }
    environment {
        // It's a good practice to use an environment variable for the IP
        APP_NODE_IP = "13.53.149.249"
    }
    stages {
        stage('Checkout') {
            steps {
                echo "Checking out the GitHub repository code..."
                
                git url: 'https://github.com/Swaksy7781/addressbook-cicd-project.git', branch: 'master'
            }
        }
        stage('Clean and Build') {
            steps {
                echo "Cleaning and building the Maven project..."
                
                sh "mvn clean"
            }
        }
        stage('Test') {
            steps {
                echo "Running unit tests..."
                
                sh "mvn test"
            }
        }
        stage('Package') {
            steps {
                echo "Packaging the application into a WAR file..."
                
                sh "mvn package"
            }
        }
        stage('Tomcat Installation') {
            steps {
                echo "Starting Ansible playbook for Tomcat installation..."
                
                sshagent(credentials: ['saurabh-wakase']) {
                    sh 'ansible-playbook -i ansible/inventory.ini ansible/webservers.yml'
                }
            }
        }
        stage('Deploy Application') {
            steps {
                echo "Deploying the WAR file to the webserver..."
                
                sshagent(credentials: ['saurabh-wakase']) {
                    sh 'ansible-playbook -i ansible/inventory.ini ansible/deployment.yml'
                }
            }
        }
    }
}

//updating file
